Concept

You encrypt both partitions with LUKS.

One partition (usually the root /) is unlocked at boot using the password you enter.

The other partition (e.g., /home) is unlocked automatically using a keyfile stored on the first (already unlocked) partition.

Since / is decrypted first, the system can read the keyfile and unlock /home without prompting again.

Step-by-Step
1. Encrypt both partitions

During installation or manually:

# Encrypt root
cryptsetup luksFormat /dev/sda1
cryptsetup open /dev/sda1 cryptroot

# Encrypt home
cryptsetup luksFormat /dev/sda2
cryptsetup open /dev/sda2 crypthome



2. Create a keyfile for /home

# Create a keyfile
dd if=/dev/urandom of=/root/home.key bs=4096 count=1
chmod 600 /root/home.key

# Add the keyfile to LUKS /home
cryptsetup luksAddKey /dev/sda2 /root/home.key

You will be prompted for your password once when adding the keyfile.


3. Configure /etc/crypttab

The crypttab file tells the system how to unlock encrypted volumes at boot.

# /etc/crypttab
cryptroot  /dev/sda1  none  luks
crypthome /dev/sda2  /root/home.key  luks


cryptroot uses a password (prompted at boot)
crypthome uses the keyfile on the root filesystem (already decrypted)


4. Update initramfs

After editing crypttab, regenerate initramfs so it knows about the keyfile:

update-initramfs -u

Or on Fedora/Arch:

mkinitcpio -P

5. Verify

Reboot. You should see one password prompt for root. /home will unlock automatically using the keyfile.

✅ Notes / Tips

Make sure the keyfile is only readable by root (chmod 600 /root/home.key).

You can also store multiple keyfiles if you have more encrypted partitions.

Avoid storing keyfiles on an unencrypted location — always on a partition that is unlocked first.
